## åŸºç¡€ç±»å‹

### æ•´å‹

- å®šä¹‰ï¼šæ­£æ•´æ•°ã€0ã€è´Ÿæ•´æ•°
- Python2.x ç”¨ `int` å­˜å‚¨å°æ•´å½¢ï¼Œç”¨ `long` å­˜å‚¨å¤§æ•´å‹ã€‚Python3.x åªç”¨ `int` æ— è®ºå¤§å°
- ä¸åŒè¿›åˆ¶çš„æ•´å‹è¡¨ç¤º
    ```
    äºŒè¿›åˆ¶ 0b...ï¼Œè½¬æ¢å‡½æ•°æ˜¯ `bin()`
    å…«è¿›åˆ¶ 0o...ï¼Œè½¬æ¢å‡½æ•°æ˜¯ `oct()`
    åå…­è¿›åˆ¶ 0x...ï¼Œè½¬æ¢å‡½æ•°æ˜¯ `hex()`
    ```
- ä» Python3.x å¼€å§‹æ”¯æŒç”¨ `_` æ¥åˆ†å‰²å¾ˆé•¿çš„æ•´å‹ï¼Œ`a = 1_000_000_000_000_000_000_000`
- å°æ•´å‹å¯¹è±¡ï¼š[-5, 257) å†…çš„æ•´å‹å¯¹è±¡ï¼ŒPython ä¼šé¢„å…ˆåˆ›å»ºå¥½ï¼Œå¹¶æ”¾åˆ°ç¼“å­˜æ± ä¸­ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡å’Œå†…å­˜ç®¡ç†æ“ä½œï¼ˆ`malloc` å’Œ `free`
  ï¼‰
- å¤§æ•´å‹å¯¹è±¡ï¼šPython ä¸ä¼šé¢„å…ˆåˆ›å»ºå¥½æ•´å½¢å¯¹è±¡ï¼Œä½†æ˜¯ä¼šé¢„å…ˆæ¢åˆ†å‡ºä¸€å¤§å—å†…å­˜ï¼Œé¿å…é¢‘ç¹çš„å†…å­˜ç®¡ç†æ“ä½œ

### æµ®ç‚¹å‹

#### æµ®ç‚¹å‹çš„è®¡ç®—çš„å‘

```
In [91]: a = 0.29
In [92]: b = 0.29 * 100
In [93]: c = int(b)
In [94]: c
Out[94]: 28

# è§£å†³æ–¹æ³•ä¸€ï¼šè½¬æ¢æˆåˆ†æ•°è®¡ç®—
In [112]: from fractions import Fraction
In [113]: a = Fraction(29) / Fraction(100)
In [114]: b = a * 100
In [115]: c = int(b)
In [116]: c
Out[116]: 29

# è§£å†³æ–¹æ³•äºŒï¼šè½¬æ¢æˆå®šç‚¹æ•°è¿ç®—
In [117]: from decimal import Decimal
In [118]: a = Decimal("0.29")
In [119]: b = a * 100
In [120]: c = int(b)
In [121]: c
Out[121]: 29
```

#### decimal çš„å››èˆäº”å…¥

```
# æƒ…å†µä¸€ï¼šå½“ç»“æœå°æ•°ç‚¹å‰é 0 æ—¶ï¼Œåˆ™ä¿ç•™çš„ä¸ªæ•°åŒ…æ‹¬æ•´æ•°ä½çš„ä¸ªæ•°
In [130]: import decimal
     ...:
     ...: decimal.getcontext().prec = 5
     ...:
     ...:
     ...: division = decimal.Decimal(77) / decimal.Decimal(3)
     ...: print(division)
25.667

# æƒ…å†µäºŒï¼šå½“å°æ•°ç‚¹å‰æ˜¯ 0 æ—¶ï¼Œç»“æœä¿ç•™ä¸ªæ•°åªåŒ…æ‹¬å°æ•°ä½çš„ä¸ªæ•°
In [4]: import decimal
In [5]: decimal.getcontext().prec = 5
In [6]: division = decimal.Decimal(1) / decimal.Decimal(3)
In [7]: print(division)
0.33333
```

#### round() çš„å‘

```
In [46]: round(11.485, 2)
Out[46]: 11.48

# é¢„æœŸç»“æœæ˜¯ 11.49ï¼ŒåŸå› æ˜¯å½“å°æ•°çš„æœ«å°¾æ˜¯ 5ï¼Œè€Œ `round()` åˆšå¥½ä½¿ç”¨æœ«å°¾çš„ 5 è¿›è¡Œå››èˆäº”å…¥æ—¶ï¼Œ
# å°†ä¸ä¼šè¿›è¡Œã€Œäº”å…¥ã€ã€‚å¯ä»¥ä½¿ç”¨ decimal æ¨¡å—ä¿®å¤è¿™ç§é—®é¢˜
In [1]: import decimal
In [2]: res = round(13.485, 2)
In [3]: correct_res = decimal.Decimal(res).quantize(decimal.Decimal('0.00'), rounding=decimal.ROUND_UP)
In [4]: print(correct_res)
13.49
```

### å­—ç¬¦ä¸²ç±»å‹

- Unicode ç§ç±»
    - Latin-1 ç¼–ç ï¼šå¦‚æœå­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½åœ¨ ASCII èŒƒå›´å†…ï¼Œåˆ™ä½¿ç”¨è¯¥ç¼–ç 
    - UCS-2 ç¼–ç ï¼šå¤§å¤šæ•°çš„éæ‹‰ä¸ç³»çš„å­—ç¬¦ï¼ˆæ¯”å¦‚ï¼šæ±‰è¯­ã€æ—¥è¯­ç­‰ï¼‰ï¼Œéƒ½ä¼šä½¿ç”¨è¯¥ç¼–ç 
    - UCS-4 ç¼–ç ï¼šå¦‚æœå­—ç¬¦ä¸²ä¸­å«æœ‰ç‰¹æ®Šå­—ç¬¦ã€emojiã€ç¨€æœ‰å­—ç¬¦ç­‰ï¼Œåˆ™ä¼šä½¿ç”¨è¯¥ç¼–ç 
- å­—ç¬¦ä¸²æ‰©å®¹è§„åˆ™ï¼šå¦‚æœä¸€ä¸ª Latin-1 ç¼–ç çš„å­—ç¬¦ä¸²åŠ å…¥äº†ä¸€ä¸ªä¸­æ–‡ï¼Œé‚£ä¹ˆåŸå…ˆçš„ Latin-1 å­—ç¬¦ä¸²æ‰€å çš„å­—èŠ‚æ•°å°†ä¼šå¢åŠ  2 å€ã€‚åŒç†ï¼Œå¦‚æœåŠ å…¥äº†ä¸€ä¸ª
  emoji è¡¨æƒ…ï¼Œ æ‰€å çš„å­—èŠ‚å°†ä¼šå¢åŠ  4 å€ã€‚æ‰€ä»¥ï¼Œå¦‚æœåœ¨ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­åŠ å…¥äº†ä¸€ä¸ª emoji å­—ç¬¦ï¼Œå†…å­˜çš„æ¶ˆè€—å¯èƒ½ä¼šå¤§å¤§å¢åŠ 
- Python ä¸ä½¿ç”¨ UTF-8 çš„åŸå› ï¼šUTF-8
  ä¸æ˜¯ä¸€ç§å®šé•¿çš„ç¼–ç æ–¹å¼ï¼Œä¼šæ ¹æ®æ¯ä¸ªå­—ç¬¦çš„å®é™…æ‰€éœ€å»åˆ†é…å­—èŠ‚æ•°ï¼Œè¿™æ ·ä¼šé€ æˆå­—ç¬¦ä¸²æ— æ³•æ ¹æ®ç´¢å¼•å¿«é€Ÿè®¿é—®ç›¸åº”å­—ç¬¦ã€‚æ¯”å¦‚ `string="abcdğŸ˜„"`
  ï¼Œ`string[4]` å°±ä¸èƒ½å®šä½åˆ° ğŸ˜„
- ç¼“å­˜æœºåˆ¶ï¼šå¯¹äº ASCII å­—ç¬¦ä¸²ï¼Œå¦‚æœé•¿åº¦æ²¡æœ‰è¶…è¿‡20ä¸ªï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šè¢«æ”¾åˆ°ç¼“å­˜æ± ä¸­
- å­—ç¬¦ä¸²æ‹¼æ¥æ€§èƒ½é—®é¢˜ï¼šå¤šä½¿ç”¨ `join()`ï¼Œè€Œä¸æ˜¯ `+`ï¼Œå‰è€…ä¸€æ¬¡æ€§åˆ†é…å†…å­˜ï¼Œåè€…å¤šæ¬¡åˆ†é…å†…å­˜
- ç¼–ç å’Œè§£ç ï¼šæŠ“ä½ç¼–ç æ–¹å’Œè§£ç æ–¹è¿™ä¸¤å¤´ï¼Œæ³¨æ„ä½¿ç”¨çš„ç¼–ç æ–¹å¼è¦ä¸€æ ·ï¼Œä¸ç„¶å¯èƒ½ä¼šå‘ç”Ÿä¹±ç 

---

## å®¹å™¨ç±»å‹

### list

Python ä¸­çš„åˆ—è¡¨åº”è¯¥å«åŠ¨æ€æ•°ç»„ï¼Œç±»ä¼¼ C++ çš„ vectorã€Java çš„ arraylistã€Go çš„
sliceï¼ŒåŠ¨æ€æ•°ç»„çš„ç‰¹æ€§å®ƒéƒ½æœ‰ã€‚åº•å±‚å­˜åœ¨åŠ¨æ€æ‰©å®¹æ“ä½œï¼Œ ä½†æ˜¯å¤–éƒ¨æ²¡æœ‰æä¾›æ“ä½œå®¹é‡çš„æ¥å£ï¼Œæ€»ä½“æ¥è¯´éšæœºè¯»æ“ä½œå’Œå°¾éƒ¨çš„å¢åˆ æ“ä½œæ€§èƒ½éƒ½å¾ˆå¥½

### dict

![](https://raw.githubusercontent.com/hsxhr-10/Blog/master/image/python%E5%AE%B9%E5%99%A8-2.png)

ä»å­—å…¸æºç çš„ç¬¬ä¸€è¡Œå°±å¯ä»¥çŸ¥é“ï¼ŒPython çš„å­—å…¸åº•å±‚æ˜¯åŸºäºå“ˆå¸Œè¡¨åšçš„ï¼Œå¹¶ä¸”æ˜¯åŸºäºå¼€å‘å¯»å€æ³•è§£å†³å†²çªçš„å“ˆå¸Œè¡¨ã€‚å“ˆå¸Œè¡¨çš„ç‰¹æ€§å®ƒéƒ½æœ‰ï¼Œåº•å±‚å­˜åœ¨åŠ¨æ€æ‰©å®¹æ“ä½œï¼Œ
æ€»çš„æ¥è¯´è¯»æ“ä½œçš„æ€§èƒ½éå¸¸å¥½ï¼Œå†™æ“ä½œçš„æ€§èƒ½ä¹Ÿä¸é”™

### set

é›†åˆçš„åº•å±‚ä¹Ÿæ˜¯å“ˆå¸Œè¡¨ï¼Œå¢åˆ æŸ¥æ“ä½œåŸºæœ¬ä¸Šå’Œå­—å…¸ä¸€æ ·ï¼Œä¸»è¦å…³æ³¨å®ƒç‰¹æœ‰çš„é›†åˆæ“ä½œ

### å…¶ä»–

é™¤äº†å†…ç½®çš„å®¹å™¨ç±»å‹ï¼Œæ ‡å‡†åº“ collections è¿˜æä¾›äº†åŒç«¯é˜Ÿåˆ—ã€äºŒå‰å †ã€æœ‰åºå­—å…¸ç­‰æ•°æ®ç»“æ„

### å‚è€ƒ

- [Built-in Types](https://docs.python.org/3/library/stdtypes.html#built-in-types)
- [Python æºç ](https://github.com/python/cpython/blob/master/Objects/dictobject.c)
- [Python æºç è§£æ](https://flaggo.github.io/python3-source-code-analysis/objects/object/)

---

## å˜é‡

### å˜é‡æŸ¥æ‰¾é¡ºåº

1. å±€éƒ¨å˜é‡ï¼ˆå‡½æ•°ä½“å†…ã€æ–¹æ³•ä½“å†…ã€ç±»å†…ï¼‰
2. é—­åŒ…å˜é‡
3. å…¨å±€å˜é‡
4. import è¿›æ¥çš„
5. å†…ç½®å˜é‡
6. æŠ¥é”™

### ä½œç”¨åŸŸçš„å‘

æ§åˆ¶æµç¨‹è¯­å¥ï¼š`ifã€forã€while` ç­‰ä¸ä¼šå°†å…¨å±€å˜é‡å˜æˆå±€éƒ¨å˜é‡

```
In [174]: x = 1

In [175]: if True:
    ...:     print(x) # æ­¤æ—¶çš„ x æ˜¯ä¸Šé¢å…¨å±€å˜é‡
    ...:     x = 2    # è¿™é‡Œèµ‹å€¼çš„ x ä¹Ÿæ˜¯å…¨å±€å˜é‡
    ...:     print(x)
    ...:
1
2
```

å‡½æ•°ã€ç±»å£°æ˜è¯­å¥ï¼š`defã€classã€lambda` ç­‰å¯ä»¥ä¼šå°†å…¨å±€å˜é‡å˜æˆå±€éƒ¨å˜é‡

```
In [104]: x = 1

In [105]: def foo():
     ...:     print(x)  # æ­¤æ—¶çš„ x è¿˜æ˜¯å…¨å±€å˜é‡
     ...:     x = 2     # å¯¹å…¨å±€å˜é‡é‡æ–°èµ‹å€¼ï¼Œx ä»å…¨å±€å˜é‡å˜æˆäº†å±€éƒ¨å˜é‡ï¼Œè¿™ä¼šå¯¼è‡´ä¸Šä¸€å¥ print(x) ä½¿ç”¨äº†æœªå®šä¹‰çš„å˜é‡
     ...:

In [106]: foo()
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)
<ipython-input-106-c19b6d9633cf> in <module>
----> 1 foo()

<ipython-input-105-916a4a5ce689> in foo()
      1 def foo():
----> 2     print(x)
      3     x = 2
      4

UnboundLocalError: local variable 'x' referenced before assignment
```

è§£å†³æ–¹æ³•æ˜¯å½“ä½¿ç”¨å…¨å±€å˜é‡æ—¶ï¼Œç”¨ `global` æ˜¾å¼å£°æ˜ã€‚

```
In [181]: x = 1

In [182]: def foo():
    ...:     global x
    ...:     print(x)
    ...:     x = 2
    ...:     print(x)
    ...:

In [183]: foo()
1
2
```

### å¯å˜å¯¹è±¡çš„å‘

- Python ä¸­çš„ä¸å¯å˜å¯¹è±¡æœ‰ï¼šæ•°å€¼ï¼ˆæ•´å‹ã€æµ®ç‚¹å‹ï¼‰ã€å­—ç¬¦ä¸²ã€tupleã€frozenset
- å¯å˜å¯¹è±¡æœ€ä¸ºé»˜è®¤å‚æ•°çš„å‘
    ```
    In [3]: def foo(l=[]):
       ...:     l.append(1)
       ...:     print(l)
       ...:
    
    In [4]: foo()
    [1]
    
    In [5]: foo()
    [1, 1]
    
    In [6]: foo()
    [1, 1, 1]
    
    In [7]: foo()
    [1, 1, 1, 1]
    ```
- å¸¸è§é¢è¯•é¢˜
  ```
  é—®ï¼šå†™å‡ºä¸‹é¢ä»£ç çš„è¾“å‡º
  
  def foo(k, v, dic={}):
      dic[k] = v
      print(dic)
  
  
  foo(1, 1)
  foo(2, 2)
  foo(3, 3, {})
  foo(4, 4)   # è¿›é˜¶è€ƒæ³•
  ```

---

## æ§åˆ¶æµç¨‹

### æ¨å¯¼å¼

- åˆ—è¡¨æ¨å¯¼å¼ï¼š`l = [i for i in range(10) if i % 2 == 0]`
- å­—å…¸æ¨å¯¼å¼ï¼š`d = {i:i for i in range(10) if i % 2 == 0}`
- é›†åˆæ¨å¯¼å¼ï¼š`s = {i for i in range(10) if i % 2 == 0}`
- å…ƒç¥–æ¨å¯¼å¼ï¼š`t = tuple((i for i in range(10) if i % 2 == 0))`

```
# æ¨å¯¼å¼é™¤äº†å¯ä»¥è®©ä»£ç é£æ ¼æ›´åŠ  Pythonic ä¹‹å¤–ï¼Œå¯¹æ€§èƒ½ä¹Ÿæœ‰æ¯”è¾ƒå¤§çš„å¥½å¤„ã€‚
# å„è¿è¡Œ 10 æ¬¡ï¼Œå–å¹³å‡å€¼ï¼Œå‰è€…è€—æ—¶ 3000ms å·¦å³ï¼Œåè€…è€—æ—¶ 650ms å·¦å³ï¼Œç›¸å·® 4.5 å€å·¦å³

# code1
if __name__ == "__main__":
    l = list()

    for i in range(9999999):
        l.append(i)

# code2
l = [i for i in range(9999999)]        
```

### `zip()` åŒæ—¶éå†å¤šä¸ªå®¹å™¨

```
In [99]: for x in zip([1, 2, 3], [4, 5, 6]):
    ...:     print(x[0], x[1])
    ...:
1 4
2 5
3 6
```

---

## å‡½æ•°

### å‚æ•°ä¼ é€’

- å€¼ä¼ é€’ï¼šç”¨äºä¸å¯å˜å¯¹è±¡ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²ã€å…ƒç¥–ã€frozensetï¼‰ï¼Œä¿®æ”¹å½¢å‚ä¸ä¼šå½±å“åˆ°å®å‚
- å¼•ç”¨ä¼ é€’ï¼šç”¨äºå¯å˜å¯¹è±¡ï¼Œå®å‚ä¼šéšç€å½¢å‚æ”¹å˜

### å¯å˜å‚æ•°

- ä½¿ç”¨åœºæ™¯ï¼šå‡½æ•°çš„å‚æ•°ä¸ªæ•°ä¸ç¡®å®šã€è£…é¥°å™¨ç­‰
- *argsï¼šä»£è¡¨è‹¥å¹²ä¸ªå€¼ï¼Œæˆ–è€…åºåˆ—çš„å±•å¼€ï¼ˆ*listã€*tupleã€*setï¼‰ï¼Œåœ¨å‡½æ•°ä½“å†…ä¼šè¢«è½¬æ¢æˆ `tuple`
- **kwargsï¼šä»£è¡¨è‹¥å¹²ä¸ªé”®å€¼å¯¹ï¼Œæˆ–è€…å­—å…¸çš„å±•å¼€ï¼ˆ**dictï¼‰ï¼Œåœ¨å‡½æ•°ä½“å†…ä¼šè¢«è½¬æ¢æˆ `dict`

### è£…é¥°å™¨

#### è£…é¥°å™¨çš„æ‰§è¡Œé¡ºåº

```python
def wrapper_out1(func):
    # å®é™…å¼€å‘ä¸­ä¸€èˆ¬ä¸åœ¨å¤–éƒ¨å†™è¯­å¥ï¼Œé¿å…è£…é¥°å™¨æ‰§è¡Œé¡ºåºå¤ªå¤æ‚
    print('--out11--')

    def inner1(*args, **kwargs):
        print("--in11--")
        ret = func(*args, **kwargs)
        print("--in12--")
        return ret

    # å®é™…å¼€å‘ä¸­ä¸€èˆ¬ä¸åœ¨å¤–éƒ¨å†™è¯­å¥ï¼Œé¿å…è£…é¥°å™¨æ‰§è¡Œé¡ºåºå¤ªå¤æ‚
    print("--out12--")
    return inner1


def wrapper_out2(func):
    print('--out21--')

    def inner2(*args, **kwargs):
        print("--in21--")
        ret = func(*args, **kwargs)
        print("--in22--")
        return ret

    print("--out22--")
    return inner2


@wrapper_out2
@wrapper_out1
def test():
    print("--test--")
    return 1 * 2


if __name__ == '__main__':
    test()
```

1. `f = wrapper_out2()(wrapper_out1()(test))`
2. ä»å³åˆ°å·¦æ‰§è¡Œï¼Œå³å…ˆ `wrapper_out1()`ã€å† `wrapper_out2()`
    ```
    --out11--
    --out12--
    --out21--
    --out22--
    ```
3. è¡¨è¾¾å¼å˜æˆ `f = inner2(inner1(test))`
4. ä»å·¦åˆ°å³æ‰§è¡Œï¼Œå³å…ˆ `inner2()`ã€å† `inner1()`ã€å† `test()`
    ```
    --in21--
    --in11--
    --test--
    --in12--
    --in22--
    ```

```
# å®Œæ•´çš„è¾“å‡ºç»“æœ
--out11--
--out12--
--out21--
--out22--
--in21--
--in11--
--test--
--in12--
--in22--
```

â€» åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¸éœ€è¦è¿™ä¹ˆå¤æ‚ï¼Œå¯ä»¥è§„å®šå…ˆæ‰§è¡Œçš„è£…é¥°å™¨æ”¾åœ¨ä¸Šé¢ï¼Œç„¶åå°†é¢å¤–çš„é€»è¾‘åŠ åœ¨ inner å‡½æ•°çš„å¼€å¤´å¤„å°±å¯ä»¥ï¼š

```python
def wrapper_out1(func):
    def inner1(*args, **kwargs):
        print("--in11--")
        ret = func(*args, **kwargs)
        return ret

    return inner1


def wrapper_out2(func):
    def inner2(*args, **kwargs):
        print("--in21--")
        ret = func(*args, **kwargs)
        return ret

    return inner2


@wrapper_out2
@wrapper_out1
def test():
    print("--test--")
    return 1 * 2
```

#### ä½¿ç”¨æ¡ˆä¾‹

```python
# åŸºæœ¬ç”¨æ³•
import functools


def decorator(f):
    @functools.wraps(f)
    def inner(*args, **kwargs):
        return f(*args, **kwargs)

    return inner


@decorator
def test(name):
    print('name: {}'.format(name))


if __name__ == '__main__':
    test('tiger')
```

```python
# å¸¦å‚è£…é¥°å™¨
import functools


def decorator(age):
    def wrapper(f):
        @functools.wraps(f)
        def inner(*args, **kwargs):
            print('age: {}'.format(age))
            return f(*args, **kwargs)

        return inner

    return wrapper


@decorator(age=23)
def test(name):
    print('name: {}'.format(name))


if __name__ == '__main__':
    test('tiger')
```

```python
# è§£è€¦ä¸šåŠ¡é€»è¾‘ä»£ç 
import functools


def auth(f):
    @functools.wraps(f)
    def inner(*args, **kwargs):
        print('auth done.')
        return f(*args, **kwargs)

    return inner


def login(f):
    @functools.wraps(f)
    def inner(*args, **kwargs):
        print('login done.')
        return f(*args, **kwargs)

    return inner


@login
@auth
def test(name):
    print('I am {}'.format(name))


if __name__ == '__main__':
    test('tiger')
```

```python
# æœ¬åœ°ç¼“å­˜
import functools


def cache(f):
    @functools.wraps(f)
    def inner(*args, **kwargs):
        inner.total += 1
        print('total: {}'.format(inner.total))
        return f(*args, **kwargs)

    inner.total = 0
    return inner


@cache
def test(name):
    print('I am {}'.format(name))


if __name__ == '__main__':
    test('tiger')
    test('tiger')
    test('tiger')
```

> `@functools.wraps(f)` æ˜¯ä¸ºäº†é˜²æ­¢è¢«è£…é¥°å‡½æ•°çš„ `__doc__`, `__name__` è¢«é”™è¯¯ä¿®æ”¹

### å‡½æ•°å¼ç¼–ç¨‹

- lambda è¡¨è¾¾å¼
- [map(func, iterator)](https://docs.python.org/3/library/functions.html#map)
- [filter(func, iterator)](https://docs.python.org/3/library/functions.html#filter)
- [functools.reduce(func, iterator)](https://docs.python.org/3/library/functools.html#functools.reduce)

### ç”Ÿæˆå™¨

ç”Ÿæˆå™¨çš„å®šä¹‰ï¼šå«æœ‰ `yield` è¯­å¥çš„å‡½æ•°ã€æ–¹æ³•å°±æ˜¯ç”Ÿæˆå™¨ã€‚

#### ç”Ÿæˆå™¨çš„æ“ä½œ

- yieldï¼š`yield` è¡¨è¾¾å¼å¯ä»¥ä¸­æ–­ç”Ÿæˆå™¨ã€‚
- `__next__()` | next()ï¼š`__next__()` æ–¹æ³• æˆ–è€… next()
  å‡½æ•°å¯ä»¥å”¤é†’ä¸­æ–­çš„è¿­ä»£å™¨ã€‚å½“ç”Ÿæˆå™¨å·²ç»æ‰§è¡Œå®Œäº†ï¼Œä¼šæŠ›å‡º `StopIterator` å¼‚å¸¸ã€‚
- send()ï¼š`send()` æ–¹æ³•å¯ä»¥å”¤é†’ä¸­æ–­çš„è¿­ä»£å™¨ï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªå€¼åˆ°ç”Ÿæˆå™¨å†…éƒ¨ï¼Œèµ‹å€¼åˆ° `yield` è¯­å¥å‰é¢çš„å˜é‡ã€‚

```
In [220]: def foo(n):
     ...:     for i in range(n):
     ...:         j = yield i
     ...:         if j == -1:
     ...:             break
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     g = foo(5)
     ...:     print(g.__next__())
     ...:     print(g.__next__())
     ...:     g.send(-1)          # ç»™ j èµ‹å€¼ -1, ç”Ÿæˆå™¨å†…çš„å¾ªç¯ç»ˆæ­¢
     ...:     print(g.__next__()) # å†æ¬¡è°ƒç”¨ __next__() æŠ›å‡º StopIteration å¼‚å¸¸
     ...:
0
1
---------------------------------------------------------------------------
StopIteration                             Traceback (most recent call last)
<ipython-input-220-af4a7bdcff3b> in <module>
     10     print(g.__next__())
     11     print(g.__next__())
---> 12     g.send(-1)
     13     print(g.__next__())

StopIteration:
```

- throw()ï¼š`throw()` æ–¹æ³•å¯ä»¥å”¤é†’ä¸­æ–­çš„è¿­ä»£å™¨ï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªå¼‚å¸¸åˆ°ç”Ÿæˆå™¨å†…éƒ¨ã€‚

```
In [225]: def foo(n):
     ...:     try:
     ...:         for i in range(n):
     ...:             j = yield i
     ...:             if j == -1:
     ...:                 break
     ...:     except ValueError:
     ...:         yield "ValueError"
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     g = foo(5)
     ...:     print(g.__next__())
     ...:     print(g.__next__())
     ...:     print(g.throw(ValueError))
     ...:
0
1
ValueError
```

- close()ï¼š`close()` æ–¹æ³•ç”¨äºä¸»åŠ¨å…³é—­ç”Ÿæˆå™¨ã€‚

#### ä½¿ç”¨åœºæ™¯

```python
# èŠ‚çœå†…å­˜ï¼šåœ¨ä¸ä½¿ç”¨ç”Ÿæˆå™¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å®æ‰“å®åœ°åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œå¯èƒ½ä¼šæ¶ˆè€—äº†ä¸å°‘å†…å­˜
def foo(max):
    l = []
    for i in range(max):
        i += 1
        l.append(i)
    return l


if __name__ == "__main__":
    # å‡è®¾ max æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°é‡ï¼Œæ¯”å¦‚ sys.maxsize
    max = 99999
    res = foo(max)
    for i in res:
        print(i)
```

```python
# ä½¿ç”¨ç”Ÿæˆå™¨ä¼˜åŒ–åä¸éœ€è¦ä¸€æ¬¡æ€§åœ°åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œåªéœ€è¦åœ¨æ¯æ¬¡ `yield` çš„æ—¶å€™ç”³è¯·å•ä¸ªå…ƒç´ çš„å†…å­˜ï¼Œçœäº†ä¸å°‘å†…å­˜
def gen(max):
    for i in range(max):
        i += 1
        yield i


if __name__ == "__main__":
    # å‡è®¾ max æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°é‡ï¼Œæ¯”å¦‚ sys.maxsize
    max = 99999
    g = gen(max)
    for i in g:
        print(i)
```

---

# Part6 å¼‚å¸¸å¤„ç†

å¼‚å¸¸çš„å®šä¹‰ï¼šå¼‚å¸¸æ˜¯æŒ‡æ½œåœ¨çš„ï¼Œå‘ç”Ÿæ—¶é—´ä¸ç¡®å®šçš„ä¸€äº›åˆ—é”™è¯¯ï¼Œæ¯”å¦‚ç£ç›˜ç©ºé—´ä¸è¶³ã€ç½‘ç»œä¸­æ–­ã€è¿è¡Œæ—¶é”™è¯¯ç­‰ã€‚

å¼‚å¸¸ä¼šå¯¼è‡´ç¨‹åºä¸­æ–­é€€å‡ºï¼Œå¼‚å¸¸å¤„ç†æœºåˆ¶ç›¸å½“äºç»™äº†ä¸€ä¸ªæœºä¼šï¼Œè®©ç¨‹åºåœ¨å‘ç”Ÿå¼‚å¸¸åèƒ½å¤Ÿé‡æ–°å¤ºå›ç¨‹åºçš„æ§åˆ¶æƒã€‚å¯¹å¼‚å¸¸çš„å¤„ç†ç¨‹åº¦ä½“ç°äº†ç¨‹åºçš„å¥å£®æ€§ã€‚

## æ ‡å‡†å¼‚å¸¸

- AttributeErrorï¼šè®¿é—®çš„å±æ€§ä¸å­˜åœ¨
- IOErrorï¼šI/O å¼‚å¸¸
- ImportErrorï¼šæ— æ³•å¼•å…¥æ¨¡å—æˆ–åŒ…ï¼Œå¤šæ˜¯è·¯å¾„é—®é¢˜ã€åç§°é”™è¯¯ã€å®‰è£…é—®é¢˜
- IndexErrorï¼šä¸‹æ ‡é”™è¯¯
- KeyErrorï¼šè®¿é—®çš„ key ä¸å­˜åœ¨
- KeyboardInterruptï¼šCtrl+C ä¿¡å·å¼•å‘
- NameErrorï¼šä½¿ç”¨æœªå®šä¹‰çš„å˜é‡
- SyntaxErrorï¼šè¯­æ³•é”™è¯¯
- TypeErrorï¼šç±»å‹ä¸åŒ¹é…
- UnboundLocalErrorï¼šè®¿é—®æœªèµ‹å€¼çš„å±€éƒ¨å˜é‡
- ValueErrorï¼šä¼ å…¥çš„å€¼ä¸ç¬¦åˆè¦æ±‚
- OSErrorï¼šç³»ç»Ÿé”™è¯¯
- RuntimeError: è¿è¡Œæ—¶é”™è¯¯

å®Œæ•´çš„å‚è€ƒ [è¿™é‡Œ](https://docs.python.org/3/tutorial/errors.html#errors-and-exceptions)
ã€‚

## å¼‚å¸¸å¤„ç†åŸåˆ™

- å¤šè€ƒè™‘å¼‚å¸¸å¤„ç†ï¼Œç‰¹åˆ«å½“ç¨‹åºæœ‰å„ç§ä¾èµ–æ—¶ï¼Œæ¯”å¦‚å¯¹æœ¬åœ°ç³»ç»Ÿçš„èµ„æºä¾èµ–ï¼ˆç£ç›˜ï¼‰ã€å¯¹ç½‘ç»œç¯å¢ƒçš„ä¾èµ–ã€ç¬¬ä¸‰æ–¹ç³»ç»Ÿç»„ä»¶çš„ä¾èµ–ç­‰
- ä¼˜å…ˆçº§è¶Šé«˜çš„å¼‚å¸¸å¤„ç†æ”¾è¶Šä¸Šé¢ï¼Œä¼˜å…ˆå¤„ç†
- ç²’åº¦è¶Šç»†ã€è¶Šå…·ä½“çš„å¼‚å¸¸ï¼Œè¶Šè¦æ”¾ä¸Šé¢ï¼Œé¿å…æ°¸è¿œéƒ½æ— æ³•æ•è·åˆ°

## è·å–å¼‚å¸¸ä¿¡æ¯

å¾ˆå¤šæ—¶å€™åœ¨æ•è·åˆ°å¼‚å¸¸ä¹‹åï¼Œéœ€è¦å°†è¯¦ç»†çš„å¼‚å¸¸ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯é”™è¯¯å †æ ˆå‘é‚®ä»¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚å…¶ä¸­ä¸€ç§æ–¹æ³•å¦‚ä¸‹ï¼š

```python
import traceback

try:
    1 / 0
except:
    print("---> æ•è·åˆ°çš„å¼‚å¸¸ä¿¡æ¯: {}".format(traceback.format_exc()))
```

# Part7 åŒ…å’Œæ¨¡å—

## ä½¿ç”¨è§„èŒƒ

- Python2.x çš„åŒ…å¿…é¡»æœ‰ `__init__.py` æ–‡ä»¶
- å¤šç”¨ `from ... import ...` è€Œä¸æ˜¯ `import m1.m2.m3`
- `from ... import ...` æ—¶å»ºè®®åˆ°æ¨¡å—ï¼Œè€Œä¸æ˜¯æ¨¡å—é‡Œé¢çš„ä¸œè¥¿
- å¦‚æœ Python æ–‡ä»¶éœ€è¦å•ç‹¬ä»¥è„šæœ¬å½¢å¼è¿è¡Œï¼ŒåŠ¡å¿…åŠ ä¸Š `if __name__ == "__main__"`ï¼Œå®ƒå¯ä»¥ç¡®ä¿ Python
  æ–‡ä»¶åœ¨å•ç‹¬è¿è¡Œæ—¶ `__name__` æ˜¯ `__main__`ï¼Œ ä»¥æ¨¡å—å½¢å¼å¯¼å…¥æ—¶ï¼Œ`__name__` æ˜¯æ¨¡å—æœ¬èº«çš„åå­—
- ç”¨ `__all__` æ§åˆ¶æ¨¡å—æš´éœ²çš„å±æ€§

## ImportError

```
test_project
.
â”œâ”€â”€ config
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â””â”€â”€ config.py
â”œâ”€â”€ main.py
â””â”€â”€ server
    â”œâ”€â”€ __init__.py
    â””â”€â”€ server.py
```

å„ä¸ªæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š

```python
# config.py
PROJECT_NAME = "test_project"
```

```python
# server.py
from config.config import PROJECT_NAME


def server():
    print(PROJECT_NAME)
    print("---> I am server")


if __name__ == "__main__":
    server()
```

```python
# main.py
from config.config import PROJECT_NAME
from server.server import server


def main():
    print(PROJECT_NAME)
    server()


if __name__ == "__main__":
    main()
```

æ‰§è¡Œ `python main.py` æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸ºå½“å‰ç›®å½•ä¸‹ç¡®å®æœ‰åŒ… config å’Œ
serverã€‚ä½†æ˜¯å½“æ‰§è¡Œ `python server/server.py` æ—¶å°±æŠ¥é”™äº†ï¼š

```
test_project â¤ python server/server.py
Traceback (most recent call last):
  File "server/server.py", line 1, in <module>
    from config.config import PROJECT_NAME
ImportError: No module named config.config
```

åŸå› æ˜¯ server ä¸‹æ²¡æœ‰ config åŒ…ï¼Œå¹¶ä¸”é¡¹ç›®çš„é¡¶çº§ç›®å½• `/test_project` ä¹Ÿä¸åœ¨ `sys.path` ä¸­ ã€‚

å¯¹äº `ImportError: No module named ...` è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä»¥ä¸‹å¸¸ç”¨çš„è§£å†³æ–¹æ³•ï¼š

- åœ¨ site-packages ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªä»¥ `.pth` ç»“å°¾çš„æ–‡ä»¶ï¼Œå°†é¡¹ç›®çš„é¡¶çº§ç›®å½•å†™è¿›å»ï¼ˆæ¨èï¼Œä¸€åŠ³æ°¸é€¸ï¼‰
- ä»¥æ¨¡å—çš„æ–¹å¼æ‰§è¡Œ `python -m ...`ï¼ˆä¸€èˆ¬ï¼‰
- åœ¨å¯¹åº”çš„ Python æ–‡ä»¶ä¸­æŠŠé¡¹ç›®çš„é¡¶çº§ç›®å½•åŠ ä¸Šï¼ˆä¸æ¨èï¼Œå› ä¸ºç›¸å…³çš„æ–‡ä»¶éƒ½è¦åŠ ï¼‰
  ```python
  import sys
  sys.path.append("/Users/tiger/develop/tmp/test_project")
  
  from config.config import PROJECT_NAME
  
  def server():
      print(PROJECT_NAME)
      print("---> I am server")
  
  
  if __name__ == "__main__":
      server()
  ```

# Part8 é¢å‘å¯¹è±¡

é¢å‘å¯¹è±¡æœ‰ä¸‰ä¸ªç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ï¼Œå’Œ "æ ¹æ­£è‹—çº¢" çš„é¢å‘å¯¹è±¡è¯­è¨€ Java ç›¸æ¯”ï¼ŒPython ä¸­çš„é¢å‘å¯¹è±¡ä¼šè¡¨ç°å¾—æœ‰æ‰€ä¸åŒã€‚

## å°è£…

Python ä¸­çš„å°è£…å¹¶ä¸èƒ½åœ¨è¯­è¨€å±‚é¢é™åˆ¶å¯¹ç§æœ‰å±æ€§çš„è®¿é—®ï¼ˆç®—æ˜¯æ˜¯ä¸ª "å‡çš„" å°è£…ï¼‰ã€‚Python ç”¨ `__` æ¥æ ‡è¯†ç§æœ‰çš„å±æ€§æˆ–è€…æ–¹æ³•ã€‚

```
In [157]: class A:
     ...:     def __init__(self):
     ...:         self.__name = "A"
     ...:
     ...:     def __get_name(self):
     ...:         return self.__name
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     a = A()
     ...:     print(a.__name)
     ...:     print(a.__get_name())
     ...:
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-157-1255c0eeaaf2> in <module>
      9 if __name__ == "__main__":
     10     a = A()
---> 11     print(a.__name)
     12     print(a.__get_name())
     13

AttributeError: 'A' object has no attribute '__name'
```

ä¹ä¸€çœ‹å¥½åƒ Python åœ¨è¯­è¨€å±‚é¢ä¹Ÿæ”¯æŒå°è£…æ€§ï¼Œå®é™…ä¸Š Python åªæ˜¯å°† `__` æ ‡è¯†çš„å˜é‡åæ”¹æˆ `_ç±»å__å±æ€§å`ã€‚ï¼ˆçŸ¥é“çœŸç›¸çš„æˆ‘çœ¼æ³ªæµä¸‹æ¥ ğŸ˜‚
ï¼‰

```
In [162]: class A:
     ...:     def __init__(self):
     ...:         self.__name = "A"
     ...:
     ...:     def __get_name(self):
     ...:         return self.__name
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     print(dir(A))
     ...:     a = A()
     ...:     print(dir(a))
     ...:
['_A__get_name', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__']
['_A__get_name', '_A__name', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__']
```

```
In [163]: class A:
     ...:     def __init__(self):
     ...:         self.__name = "A"
     ...:
     ...:     def __get_name(self):
     ...:         return self.__name
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     a = A()
     ...:     print(a._A__name)
     ...:     print(a._A__get_name())
     ...:
A
A
```

> å•ä¸‹åˆ’çº¿ `_` ç”¨æ¥æ ‡è¯†æ¨¡å—çš„ç§æœ‰æˆå‘˜

## ç»§æ‰¿

Python æ”¯æŒå¤šç»§æ‰¿ï¼ŒJava ä¸æ”¯æŒã€‚å¸¸ç”¨çš„ Mixin æ¨¡å¼å°±æ˜¯åŸºäºå¤šç»§æ‰¿çš„ç‰¹æ€§ï¼Œå­ç±»å¯ä»¥ç»§æ‰¿ä¸åŒçš„ Mixin ç±»ï¼ŒåŠ¨æ€ç»„åˆéœ€è¦çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œ
People å¯èƒ½é™¤äº†è·‘æ­¥è¿˜ä¼šæ¸¸æ³³ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡æ–°å¢ Mixin ç±»æ¥ç»§æ‰¿å®ç°ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸä»£ç çš„åŸºç¡€ä¸Šæ‰©å±•ä¸šåŠ¡é€»è¾‘äº†ã€‚

```
In [165]: class DictMixin:
     ...:     def __getitem__(self, key):
     ...:         return self.__dict__[key]
     ...:
     ...:     def __setitem__(self, key, value):
     ...:         self.__dict__[key] = value
     ...:
     ...:
     ...: class RunnertMixin:
     ...:     def run(self):
     ...:         print("---> I can run")
     ...:
     ...:
     ...: class People(DictMixin, RunnertMixin):
     ...:     def __init__(self, name, age, sex):
     ...:         self.name = name
     ...:         self.age = age
     ...:         self.sex = sex
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     p = People("yoko", 23, "female")
     ...:     print(p["name"], p["age"], p["sex"])
     ...:     p.run()
     ...:
yoko 23 female
---> I can run
```

## å¤šæ€

Python å¯ä»¥åšå‡ºå¤šæ€çš„æ•ˆæœï¼Œä½†æ˜¯ç”±äº Python æ˜¯åŠ¨æ€è¯­è¨€ï¼Œæœ¬èº«æ²¡æœ‰é™æ€ç±»å‹é™åˆ¶å’Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œä¸å­˜åœ¨å‘ä¸Šè½¬å‹ã€å‘ä¸‹è½¬å‹è¿™äº›æ¦‚å¿µï¼Œ
ç†è®ºä¸Šå®ƒçš„å˜é‡å¯ä»¥æ¥å—ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œç®—æ˜¯ä¸ª "å‡çš„" å¤šæ€ã€‚

## ç±»å’Œå¯¹è±¡

### `__init__()` å’Œ `__new__()`

- `__init__()` ç”¨æ¥åˆå§‹åŒ–å¯¹è±¡
- `__new__()` ç”¨æ¥åˆ›å»ºå¯¹è±¡ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨æ¥å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼

### @property

`@property` ç”¨æ¥å†™ç±»ä¼¼ Java çš„ getter/setter æ–¹æ³•ã€‚

```
In [167]: class People:
     ...:     def __init__(self, name, age, sex):
     ...:         self.__name = name
     ...:         self.__age = age
     ...:         self.__sex = sex
     ...:
     ...:     @property
     ...:     def name(self):
     ...:         return self.__name
     ...:
     ...:     @property
     ...:     def age(self):
     ...:         return self.__age
     ...:
     ...:     @property
     ...:     def sex(self):
     ...:         return self.__sex
     ...:
     ...:     @name.setter
     ...:     def name(self, name):
     ...:         self.__name = name
     ...:
     ...:     @age.setter
     ...:     def age(self, age):
     ...:         if age < 0 or age > 250:
     ...:             return
     ...:         self.__age = age
     ...:
     ...:     @sex.setter
     ...:     def sex(self, sex):
     ...:         if sex not in ("male", "female", "transsexual"):
     ...:             return
     ...:         self.__sex = sex
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     p = People("yoko", 23, "female")
     ...:     print(p.name, p.age, p.sex)
     ...:
     ...:     p.name = "yoko1"
     ...:     p.age = 24
     ...:     p.sex = "male"
     ...:     print(p.name, p.age, p.sex)
     ...:
yoko 23 female
yoko1 24 male
```

### super()

- `super()` ä¸€èˆ¬ç”¨äºè°ƒç”¨åŸºç±»çš„æ–¹æ³•
- å¤šç»§æ‰¿æ—¶ï¼Œ`super().xxx` å¯¹åº”çš„æ˜¯ç¬¬ä¸€ä¸ªåŸºç±»

### ä¿®æ”¹ç±»å±æ€§çš„é™·é˜±

å¯¹ç±»å±æ€§çš„ä¿®æ”¹å¿…é¡»é€šè¿‡ç±»æœ¬èº«è¿›è¡Œï¼Œå¦‚æœé€šè¿‡å¯¹è±¡ä¿®æ”¹ï¼ŒPython è¿è¡Œæ—¶åªä¼šç»™å¯¹è±¡æ–°å¢ä¸€ä¸ªå±æ€§ï¼š

```
In [173]: class A:
     ...:     flag = 1
     ...:
     ...:
     ...: class B(A):
     ...:     pass
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     a = A()
     ...:     b = B()
     ...:     print("---> ä¿®æ”¹å‰ A.flag:", A.flag)
     ...:     print("---> ä¿®æ”¹å‰ B.flag:", B.flag)
     ...:     print("---> ä¿®æ”¹å‰ a.flag:", a.flag)
     ...:     print("---> ä¿®æ”¹å‰ b.flag:", b.flag)
     ...:
     ...:     a.flag = 2
     ...:     print("---> ä¿®æ”¹å A.flag:", A.flag)
     ...:     print("---> ä¿®æ”¹å B.flag:", B.flag)
     ...:     print("---> ä¿®æ”¹å a.flag:", a.flag)
     ...:     print("---> ä¿®æ”¹å b.flag:", b.flag)
     ...:
---> ä¿®æ”¹å‰ A.flag: 1
---> ä¿®æ”¹å‰ B.flag: 1
---> ä¿®æ”¹å‰ a.flag: 1
---> ä¿®æ”¹å‰ b.flag: 1

---> ä¿®æ”¹å A.flag: 1
---> ä¿®æ”¹å B.flag: 1
---> ä¿®æ”¹å a.flag: 2
---> ä¿®æ”¹å b.flag: 1
```

è§£å†³æ–¹æ³•æ˜¯é€šè¿‡ç±»æ¥ä¿®æ”¹ï¼š

```
In [174]: class A:
     ...:     flag = 1
     ...:
     ...:
     ...: class B(A):
     ...:     pass
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     a = A()
     ...:     b = B()
     ...:     print("---> ä¿®æ”¹å‰ A.flag:", A.flag)
     ...:     print("---> ä¿®æ”¹å‰ B.flag:", B.flag)
     ...:     print("---> ä¿®æ”¹å‰ a.flag:", a.flag)
     ...:     print("---> ä¿®æ”¹å‰ b.flag:", b.flag)
     ...:
     ...:     A.flag = 2
     ...:     print("---> ä¿®æ”¹å A.flag:", A.flag)
     ...:     print("---> ä¿®æ”¹å B.flag:", B.flag)
     ...:     print("---> ä¿®æ”¹å a.flag:", a.flag)
     ...:     print("---> ä¿®æ”¹å b.flag:", b.flag)
     ...:
---> ä¿®æ”¹å‰ A.flag: 1
---> ä¿®æ”¹å‰ B.flag: 1
---> ä¿®æ”¹å‰ a.flag: 1
---> ä¿®æ”¹å‰ b.flag: 1

---> ä¿®æ”¹å A.flag: 2
---> ä¿®æ”¹å B.flag: 2
---> ä¿®æ”¹å a.flag: 2
---> ä¿®æ”¹å b.flag: 2
```

### ç±»æ–¹æ³•

å¯¹è±¡å¯ä»¥ä½¿ç”¨ç±»å±æ€§ï¼Œä½†æ˜¯åè¿‡æ¥ç±»ä¸èƒ½ä½¿ç”¨å¯¹è±¡çš„å±æ€§ï¼š

```
In [181]: class A:
     ...:     flag = 1
     ...:
     ...:     def __init__(self):
     ...:         self.name = "xxx"
     ...:
     ...:
     ...:     @classmethod
     ...:     def show(cls):
     ...:         print(cls.flag)
     ...:         print(cls.name)
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     a = A()
     ...:     a.show()
     ...:
1
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-181-85a8b09c1f8b> in <module>
     14 if __name__ == "__main__":
     15     a = A()
---> 16     a.show()

<ipython-input-181-85a8b09c1f8b> in show(cls)
      9     def show(cls):
     10         print(cls.flag)
---> 11         print(cls.name)
     12
     13

AttributeError: type object 'A' has no attribute 'name'
```

## é­”æœ¯æ–¹æ³•

Python æå€¡çš„æ˜¯ã€Œé¸­å­ç±»å‹ã€ï¼Œå³ç±»ä¸éœ€è¦æ˜¾å¼å£°æ˜è‡ªå·±æ˜¯åªé¸­ï¼Œåªè¦èƒ½è¡¨ç°å¾—åƒåªé¸­ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºä»–æ˜¯åªé¸­ ğŸ˜‚
ã€‚é­”æœ¯æ–¹æ³•ï¼ˆå±æ€§ï¼‰æ­£æ˜¯è¿™ç§æ€æƒ³çš„ä½“ç°ï¼Œé€šè¿‡ä¸ºç±»æ·»åŠ é­”æœ¯æ–¹æ³•ï¼Œ è®©ç±»å¯ä»¥è¡¨ç°å‡ºå…¶ä»–ç±»å‹çš„ç‰¹å¾ã€‚

### æ§åˆ¶å±æ€§è®¿é—®

#### (1) è·å–å±æ€§

è·å–å±æ€§å¯ä»¥é€šè¿‡ `obj.attr` æˆ–è€… `getattr(obj, "attr")`ï¼Œä¸¤è€…æ•ˆæœä¸€è‡´ã€‚å½“å±æ€§ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œé»˜è®¤æŠ›å‡º
AttributeError å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœå®ç°äº†
`__getattr__()` æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯è¯¥æ–¹æ³•ï¼Œè€Œä¸”è¿”å›è¯¥æ–¹æ³•çš„å€¼æˆ–è€… `None`ã€‚

```
In [196]: class A:
     ...:     def __init__(self):
     ...:         self.name = "class A"
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     a = A()
     ...:     print(getattr(a, "name"))
     ...:     print(getattr(a, "age"))
     ...:
class A
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-196-87a6dea80e1d> in <module>
      7     a = A()
      8     print(getattr(a, "name"))
----> 9     print(getattr(a, "age"))
     10

AttributeError: 'A' object has no attribute 'age'
```

```
In [197]: class B:
     ...:     def __init__(self):
     ...:         self.name = "class B"
     ...:
     ...:     def __getattr__(self, item):
     ...:         return 23 if item == "age" else "unknown"
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     b = B()
     ...:     print(getattr(b, "name"))
     ...:     print(getattr(b, "age"))
     ...:     print(getattr(b, "sex"))
     ...:
class B
23
unknown
```

åœ¨ `__getattr__()` ä¸­è°ƒç”¨ `getattr()`ï¼Œä¼šé€ æˆé€’å½’çˆ†æ ˆï¼š

```
In [198]: class B:
     ...:     def __init__(self):
     ...:         self.name = "class B"
     ...:
     ...:     def __getattr__(self, item):
     ...:         return getattr(self, item)
     ...:
     ...:
     ...: if __name__ == "__main__":
     ...:     b = B()
     ...:     print(getattr(b, "name"))
     ...:     print(getattr(b, "age"))
     ...:     print(getattr(b, "sex"))
     ...:
class B
---------------------------------------------------------------------------
RecursionError                            Traceback (most recent call last)
<ipython-input-198-d176bb5a25d5> in <module>
     10     b = B()
     11     print(getattr(b, "name"))
---> 12     print(getattr(b, "age"))
     13     print(getattr(b, "sex"))
     14

<ipython-input-198-d176bb5a25d5> in __getattr__(self, item)
      4
      5     def __getattr__(self, item):
----> 6         return getattr(self, item)
      7
      8

... last 1 frames repeated, from the frame below ...

<ipython-input-198-d176bb5a25d5> in __getattr__(self, item)
      4
      5     def __getattr__(self, item):
----> 6         return getattr(self, item)
      7
      8

RecursionError: maximum recursion depth exceeded
```

#### (2) æ·»åŠ å±æ€§ | ä¿®æ”¹å±æ€§å€¼

Python ä½œä¸ºä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å±æ€§æ˜¯å¾ˆåˆç†çš„ ğŸ¶ ï¼Œã€ŒçŒ´å­è¡¥ä¸ã€ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªåŸç†ã€‚

åŠ¨æ€æ·»åŠ å±æ€§å¯ä»¥é€šè¿‡ `obj.attr = value` æˆ–è€… `setattr(obj, "attr", value)`
ï¼Œä¸¤è€…æ•ˆæœä¸€è‡´ã€‚å¦‚æœå®šä¹‰äº† `__setattr__()` æ–¹æ³•ï¼Œåˆ™æœ€ç»ˆè°ƒç”¨çš„æ˜¯è¯¥æ–¹æ³•ã€‚ å­˜åœ¨çˆ†æ ˆé—®é¢˜ï¼Œæ·»åŠ ã€ä¿®æ”¹å±æ€§æ—¶åº”è¯¥ç”¨ `self.__dict__`
ï¼Œæ¯”å¦‚ `self.__dict__[name] = value`ã€‚

#### (3) åˆ é™¤å±æ€§

åˆ é™¤å±æ€§å¯ä»¥é€šè¿‡ `del obj.attr` æˆ–è€… `delattr(obj, "attr")`ï¼Œä¸¤è€…æ•ˆæœä¸€è‡´ã€‚å¦‚æœå®šä¹‰äº† `__delattr__()`
æ–¹æ³•ï¼Œåˆ™æœ€ç»ˆè°ƒç”¨çš„æ˜¯è¯¥æ–¹æ³•ã€‚å­˜åœ¨çˆ†æ ˆé—®é¢˜ï¼Œåˆ é™¤å±æ€§æ—¶åº”è¯¥ç”¨ `self.__dict__`ã€‚

### å…¶ä»–é­”æœ¯æ–¹æ³•

é™¤äº†å±æ€§è®¿é—®ç›¸å…³çš„é­”æœ¯æ–¹æ³•ä¹‹å¤–ï¼Œå¸¸è§è¿˜æœ‰ï¼š

- åˆ›å»ºã€åˆå§‹åŒ–ç›¸å…³çš„ï¼š`__new__()`ï¼Œ`__init__()`
- å†…å­˜å›æ”¶ç›¸å…³çš„ï¼š`__del__()`ï¼ˆå¦‚æœä¸¤ä¸ªå¯¹è±¡å¾ªç¯å¼•ç”¨ï¼Œå¹¶ä¸”å…¶ä¸­ä¸€ä¸ªè‡ªå®šä¹‰äº†è¯¥æ–¹æ³•ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼‰
- ç”¨æ¥èŠ‚çœå†…å­˜ç›¸å…³çš„ï¼š`__slots__()`
- å¯è°ƒç”¨å¯¹è±¡ï¼š`__call__()`
-

å­—ç¬¦ä¸²ç›¸å…³çš„ï¼š[è¿™é‡Œ](https://docs.python.org/3/reference/datamodel.html#object.__repr__)
-
å®¹å™¨ç›¸å…³çš„ï¼š[è¿™é‡Œ](https://docs.python.org/3/reference/datamodel.html#emulating-container-types)
-
ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š[è¿™é‡Œ](https://docs.python.org/3/reference/datamodel.html#with-statement-context-managers)
-
å­ç±»æ£€æµ‹ç›¸å…³çš„ï¼š[è¿™é‡Œ](https://docs.python.org/3/reference/datamodel.html#customizing-instance-and-subclass-checks)
-
æ¯”è¾ƒè¿ç®—ç¬¦ç›¸å…³çš„ï¼š[è¿™é‡Œ](https://docs.python.org/3/reference/datamodel.html#object.__lt__)
-
æ•°å€¼è¿ç®—ç¬¦ç›¸å…³çš„ï¼š[è¿™é‡Œ](https://docs.python.org/3/reference/datamodel.html#emulating-numeric-types)